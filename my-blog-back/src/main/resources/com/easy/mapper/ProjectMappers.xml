<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.easy.mapper.ProjectMappers">

	<!-- 实体映射 -->
	<resultMap id="base_result_map" type="com.easy.entity.po.Project">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<result column="description" property="description"/>
		<result column="type" property="type"/>
		<result column="readme" property="readme"/>
		<result column="create_time" property="createTime"/>
		<result column="update_time" property="updateTime"/>
	</resultMap>

	<!-- 通用查询结果列 -->
	<sql id="base_column_list">
		id, name, description, type, readme, create_time, update_time
	</sql>

	<!-- 基础查询条件 -->
	<sql id="base_query_condition">
		<if test="query.id != null">
			and id = #{query.id}
		</if>
		<if test="query.name != null and query.name != ''">
			and name = #{query.name}
		</if>
		<if test="query.type != null and query.type != ''">
			and type = #{query.type}
		</if>
		<if test="query.createTime != null">
			and create_time = #{query.createTime}
		</if>
		<if test="query.updateTime != null">
			and update_time = #{query.updateTime}
		</if>
	</sql>

	<!-- 扩展查询条件 -->
	<sql id="base_query_condition_extend">
		<if test="query.nameFuzzy != null and query.nameFuzzy != ''">
			and name like concat('%', #{query.nameFuzzy}, '%')
		</if>
		<if test="query.typeFuzzy != null and query.typeFuzzy != ''">
			and type like concat('%', #{query.typeFuzzy}, '%')
		</if>
		<if test="query.createTimeStart != null and query.createTimeStart != ''">
			<![CDATA[ and create_time >= str_to_date(#{query.createTimeStart}, '%Y-%m-%d') ]]>
		</if>
		<if test="query.createTimeEnd != null and query.createTimeEnd != ''">
			<![CDATA[ and create_time < date_sub(str_to_date(#{query.createTimeEnd}, '%Y-%m-%d'), interval -1 day) ]]>
		</if>
		<if test="query.updateTimeStart != null and query.updateTimeStart != ''">
			<![CDATA[ and update_time >= str_to_date(#{query.updateTimeStart}, '%Y-%m-%d') ]]>
		</if>
		<if test="query.updateTimeEnd != null and query.updateTimeEnd != ''">
			<![CDATA[ and update_time < date_sub(str_to_date(#{query.updateTimeEnd}, '%Y-%m-%d'), interval -1 day) ]]>
		</if>
	</sql>

	<!-- 查询条件 -->
	<sql id="query_condition">
		<where>
			<include refid="base_query_condition"/>
			<include refid="base_query_condition_extend"/>
		</where>
	</sql>

	<!-- 查询列表 -->
	<select id="selectList" resultMap="base_result_map" parameterType="com.easy.entity.query.ProjectQuery">
		SELECT <include refid="base_column_list"/>
		FROM projects
		<include refid="query_condition"/>
		<if test="query.orderBy != null">ORDER BY ${query.orderBy}</if>
		<if test="query.simplePage != null">LIMIT #{query.simplePage.start}, #{query.simplePage.end}</if>
	</select>

	<!-- 查询数量 -->
	<select id="selectCount" resultType="java.lang.Integer" parameterType="com.easy.entity.query.ProjectQuery">
		SELECT COUNT(1) FROM projects
		<include refid="query_condition"/>
	</select>

	<!-- 单条插入 -->
	<insert id="insert" parameterType="com.easy.entity.po.Project" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO projects
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">id,</if>
			<if test="bean.name != null">name,</if>
			<if test="bean.description != null">description,</if>
			<if test="bean.type != null">type,</if>
			<if test="bean.readme != null">readme,</if>
			<if test="bean.createTime != null">create_time,</if>
			<if test="bean.updateTime != null">update_time,</if>
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">#{bean.id},</if>
			<if test="bean.name != null">#{bean.name},</if>
			<if test="bean.description != null">#{bean.description},</if>
			<if test="bean.type != null">#{bean.type},</if>
			<if test="bean.readme != null">#{bean.readme},</if>
			<if test="bean.createTime != null">#{bean.createTime},</if>
			<if test="bean.updateTime != null">#{bean.updateTime},</if>
		</trim>
	</insert>


	<!-- 插入或更新 -->
	<insert id="insertOrUpdate" parameterType="com.easy.entity.po.Project">
		INSERT INTO projects
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">id,</if>
			<if test="bean.name != null">name,</if>
			<if test="bean.description != null">description,</if>
			<if test="bean.type != null">type,</if>
			<if test="bean.readme != null">readme,</if>
			<if test="bean.createTime != null">create_time,</if>
			<if test="bean.updateTime != null">update_time,</if>
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">#{bean.id},</if>
			<if test="bean.name != null">#{bean.name},</if>
			<if test="bean.description != null">#{bean.description},</if>
			<if test="bean.type != null">#{bean.type},</if>
			<if test="bean.readme != null">#{bean.readme},</if>
			<if test="bean.createTime != null">#{bean.createTime},</if>
			<if test="bean.updateTime != null">#{bean.updateTime},</if>
		</trim>
		ON DUPLICATE KEY UPDATE
		<trim suffixOverrides=",">
			<if test="bean.name != null">name = VALUES(name),</if>
			<if test="bean.description != null">description = VALUES(description),</if>
			<if test="bean.type != null">type = VALUES(type),</if>
			<if test="bean.readme != null">readme = VALUES(readme),</if>
			<if test="bean.createTime != null">create_time = VALUES(create_time),</if>
			<if test="bean.updateTime != null">update_time = VALUES(update_time),</if>
		</trim>
	</insert>

	<!-- 批量插入 -->
	<insert id="insertBatch" parameterType="java.util.List">
		INSERT INTO projects (name, description, type, readme, create_time, update_time) VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.name}, #{item.description}, #{item.type}, #{item.readme}, #{item.createTime}, #{item.updateTime})
		</foreach>
	</insert>

	<!-- 批量插入或更新 -->
	<insert id="insertOrUpdateBatch" parameterType="java.util.List">
		INSERT INTO projects (name, description, type, readme, create_time, update_time) VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.name}, #{item.description}, #{item.type}, #{item.readme}, #{item.createTime}, #{item.updateTime})
		</foreach>
		ON DUPLICATE KEY UPDATE
		name = VALUES(name),
		description = VALUES(description),
		type = VALUES(type),
		readme = VALUES(readme),
		create_time = VALUES(create_time),
		update_time = VALUES(update_time)
	</insert>

	<!-- 根据Id查询 -->
	<select id="selectById" resultMap="base_result_map" parameterType="java.lang.Integer">
		SELECT <include refid="base_column_list"/>
		FROM projects
		WHERE id = #{id}
	</select>

	<!-- 根据Id更新 -->
	<update id="updateById" parameterType="com.easy.entity.po.Project">
		UPDATE projects
		<set>
			<if test="bean.name != null">name = #{bean.name},</if>
			<if test="bean.description != null">description = #{bean.description},</if>
			<if test="bean.type != null">type = #{bean.type},</if>
			<if test="bean.readme != null">readme = #{bean.readme},</if>
			<if test="bean.createTime != null">create_time = #{bean.createTime},</if>
			<if test="bean.updateTime != null">update_time = #{bean.updateTime},</if>
		</set>
		WHERE id = #{id}
	</update>

	<!-- 根据Id删除 -->
	<delete id="deleteById" parameterType="java.lang.Integer">
		DELETE FROM projects WHERE id = #{id}
	</delete>

	<!-- 根据Name查询 -->
	<select id="selectByName" resultMap="base_result_map" parameterType="java.lang.String">
		SELECT <include refid="base_column_list"/>
		FROM projects
		WHERE name = #{name}
	</select>

	<!-- 根据Name更新 -->
	<update id="updateByName" parameterType="com.easy.entity.po.Project">
		UPDATE projects
		<set>
			<if test="bean.name != null">name = #{bean.name},</if>
			<if test="bean.description != null">description = #{bean.description},</if>
			<if test="bean.type != null">type = #{bean.type},</if>
			<if test="bean.readme != null">readme = #{bean.readme},</if>
			<if test="bean.createTime != null">create_time = #{bean.createTime},</if>
			<if test="bean.updateTime != null">update_time = #{bean.updateTime},</if>
		</set>
		WHERE name = #{name}
	</update>

	<!-- 根据Name删除 -->
	<delete id="deleteByName" parameterType="java.lang.String">
		DELETE FROM projects WHERE name = #{name}
	</delete>

</mapper>
